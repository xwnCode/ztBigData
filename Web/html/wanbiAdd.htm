<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title></title>
    <link href="easyui/easyui.css" rel="stylesheet" type="text/css" />
    <link href="easyui/icon.css" rel="stylesheet" type="text/css" />
    <script src="easyui/jquery.min.js" type="text/javascript"></script>
    <script src="easyui/jquery.easyui.min.js" type="text/javascript"></script>
    <script src="easyui/easyui-lang-zh_CN.js" type="text/javascript"></script>
</head>
<body>
    <div id="divToolFriendLink">
        <!--        站点名称：
        <input id="Name" class="textbox" style="width: 180px;" />
        <a id="A2" onclick="Search()" class="easyui-linkbutton" data-options="iconCls:'icon-search'">
            查询</a>-->
        <!-- &nbsp;&nbsp;&nbsp;&nbsp; <a href="javascript:void(0)" class="easyui-linkbutton"
                data-options="iconCls:'icon-add'" onclick="append()">添加</a> <a href="javascript:void(0)"
                    class="easyui-linkbutton" data-options="iconCls:'icon-remove'" onclick="removeit()">
                    移除</a> -->
        <a href="javascript:void(0)" class="easyui-linkbutton" data-options="iconCls:'icon-save'"
            onclick="Add()">下发</a>
    </div>
    <table id="tbFriendLink">
        <thead>
            <tr>
                <th field="ck" checkbox="true">
                </th>
<!--                <th data-options="field:'DateOfdata',formatter:date">
                    数据日期
                </th>-->
                <th data-options="field:'mdName',width: 120">
                    锚段名称
                </th>
                <th data-options="field:'code',width: 120">
                    编号
                </th>
                <th data-options="field:'type',width: 40">
                    类型
                </th>
                <th data-options="field:'czz',width: 40">
                    承支座
                </th>
                <th data-options="field:'psr',width: 40">
                    平双耳
                </th>
                <th data-options="field:'xsr',width: 40">
                    斜双耳
                </th>
                <th data-options="field:'dwh',width: 40">
                    定位环1/2
                </th>
                <th data-options="field:'dwz',width: 40">
                    定位座
                </th>
                <th data-options="field:'ffk',width: 40">
                    防风卡
                </th>
                <th data-options="field:'pwb',width: 40">
                    平腕臂
                </th>
                <th data-options="field:'xwb',width: 40">
                    斜腕臂
                </th>
                <th data-options="field:'dwg',width: 80">
                    定位管1/2
                </th>
                <th data-options="field:'wbzcL',width: 100">
                    腕臂支撑_支撑长
                </th>
                <th data-options="field:'wbzcP',width: 100">
                    腕臂支撑_平位置
                </th>
                <th data-options="field:'wbzcX',width: 100">
                    腕臂支撑_斜位置
                </th>
                <th data-options="field:'dwzc1L',width: 120">
                    定位支撑(一)_支撑长
                </th>
                <th data-options="field:'dwzc1B',width: 120">
                    定位支撑(一)_臂位置
                </th>
                <th data-options="field:'dwzc1D',width: 120">
                    定位支撑(一)_定位置
                </th>
                <th data-options="field:'dwzc2L',width: 120">
                    定位支撑(二)_支撑长
                </th>
                <th data-options="field:'dwzc2B',width: 120">
                    定位支撑(二)_臂位置
                </th>
                <th data-options="field:'dwzc2D',width: 120">
                    定位支撑(二)_定位置
                </th>
                <th data-options="field:'dwParam',width: 60">
                    定位参数
                </th>
                <th data-options="field:'dzParam',width: 60">
                    底座参数
                </th>
                <th data-options="field:'xgParam',width: 60">
                    悬挂参数
                </th>
                <th data-options="field:'dwpd',width: 80">
                    定位坡度
                </th>
            </tr>
        </thead>
    </table>
    <script type="text/javascript">
        $('#tbFriendLink').datagrid({
            iconCls: 'icon-edit', //图标 
            singleSelect: false, //是否单选 
            toolbar: '#divToolFriendLink',
            nowrap: false,
            striped: true,
            border: true,
            collapsible: false, //是否可折叠的               
            url: '../databywb/GetProDataByBIMwb.ashx',
            remoteSort: false,
            rownumbers: true, //行号           
            queryParams: {
                operate: 'List'
            }
        });

        function date(value, row, index) {
            var timestamp = value;
            var date = new Date(parseInt(timestamp.replace("/Date(", "").replace(")/", ""), 10));
            Y = date.getFullYear() + '-';
            M = (date.getMonth() + 1 < 10 ? '0' + (date.getMonth() + 1) : date.getMonth() + 1) + '-';
            D = (date.getDate() < 10 ? '0' + (date.getDate()) : date.getDate()) + ' ';
            h = (date.getHours() < 10 ? '0' + (date.getHours()) : date.getHours()) + ':';
            m = (date.getMinutes() < 10 ? '0' + (date.getMinutes()) : date.getMinutes()) + ':';
            s = (date.getSeconds() < 10 ? '0' + (date.getSeconds()) : date.getSeconds());
            //var NewDtime = Y + M + D + h + m + s;
            var NewDtime = Y + M + D;
            return NewDtime;
        }


        var editIndex = undefined;
        function endEditing() {
            if (editIndex == undefined) { return true }
            if ($('#tbFriendLink').datagrid('validateRow', editIndex)) {

                $('#tbFriendLink').datagrid('endEdit', editIndex);
                editIndex = undefined;
                return true;
            } else {
                return false;
            }
        }

        function onClickRow(index) {
            if (editIndex != index) {
                if (endEditing()) {
                    $('#tbFriendLink').datagrid('selectRow', index)
							.datagrid('beginEdit', index);
                    editIndex = index;
                } else {
                    $('#tbFriendLink').datagrid('selectRow', editIndex);
                }
            }
        }

        function append() {
            if (endEditing()) {
                $('#tbFriendLink').datagrid('appendRow', { IsView: '展示' });
                editIndex = $('#tbFriendLink').datagrid('getRows').length - 1;
                $('#tbFriendLink').datagrid('selectRow', editIndex)
						.datagrid('beginEdit', editIndex);
            }
        }

        function removeit() {
            if (editIndex == undefined) { return }
            $('#tbFriendLink').datagrid('cancelEdit', editIndex)
					.datagrid('deleteRow', editIndex);
            editIndex = undefined;
        }

        function accept() {
            if (endEditing()) {
                if ($('#tbFriendLink').datagrid('getChanges').length) {
                    //                    var inserted = $('#tbFriendLink').datagrid('getChanges', "inserted");
                    //                    var deleted = $('#tbFriendLink').datagrid('getChanges', "deleted");
                    var updated = $('#tbFriendLink').datagrid('getChanges', "updated");

                    var effectRow = new Object();

                    //                    if (inserted.length) {
                    //                        effectRow["inserted"] = JSON.stringify(inserted);
                    //                    }
                    //                    if (deleted.length) {
                    //                        effectRow["deleted"] = JSON.stringify(deleted);
                    //                    }
                    if (updated.length) {
                        effectRow["updated"] = JSON.stringify(updated);
                    }
                    $.post("sgzdOperate.ashx", effectRow, function (rsp) {
                        if (rsp.statu) {
                            alert(rsp.Message);
                            $('#tbFriendLink').datagrid('acceptChanges');
                        } else {
                            alert(rsp.Message);
                        }
                    }, "JSON").error(function () {
                        $.messager.alert("提示", "提交错误了！");
                    });
                }
            }
        }

        function reject() {
            $('#tbFriendLink').datagrid('rejectChanges');
            editIndex = undefined;
        }

        function getChanges() {
            var rows = $('#tbFriendLink').datagrid('getChanges');
            alert(rows.length + ' rows are changed!');
        }

        function Search() {
            var Name = document.getElementById("Name").value;
            //var LinkUrl = document.getElementById("LinkUrl").value;
            $('#tbFriendLink').datagrid({
                url: 'sgzd.ashx',
                queryParams: {
                    Name: Name
                    //LinkUrl: LinkUrl,                   
                }
            })
        }

        function Add() {
            var rows = $('#tbFriendLink').datagrid('getSelections');
            var effectRow = new Object();
            effectRow["Add"] = JSON.stringify(rows);
            effectRow["operate"] = "Add";
            if (rows.length >= 1) {
                $.post("../databywb/GetProDataByBIMwb.ashx", effectRow, function (rsp) {
                    if (rsp) {
                        alert("下发成功");
                        $('#tbFriendLink').datagrid('reload');
                    } else {
                        alert(rsp.Message);
                    }
                }, "JSON").error(function () {
                    $.messager.alert("提示", "下发失败！");
                });
            } else {
                alert('请选择一条数据！');
            }
        }
    </script>
</body>
</html>
