<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title></title>
      <link href="../easyui/easyui.css" rel="stylesheet" type="text/css" />
    <link href="../easyui/icon.css" rel="stylesheet" type="text/css" />
    <script src="../easyui/jquery.min.js" type="text/javascript"></script>
    <script src="../easyui/jquery.easyui.min.js" type="text/javascript"></script>
    <script src="../easyui/easyui-lang-zh_CN.js" type="text/javascript"></script>
</head>
<body style="font-size: 12px; background-color: #ffffff;">
    <div>
<!--        <table cellpadding="0px" cellspacing="0px">
            <tr>
                <td style="width: 100px; height: 30px; text-align: right">   
                    标题：
                </td>
                <td colspan="3" style="width: 450px;">
                    <input id="txtNoticeTitle" class="textbox" style="width: 430px;" />
                </td>
                <td rowspan="2" style="width: 100px; text-align: right">
                    <input type="button" value="查 询" style="height: 30px; width: 60px" class="selectbutton"
                        onclick="MessageDoSearch()" />
                </td>
            </tr>
            <tr>
                <td style="width: 100px; height: 30px; text-align: right">
                    日期介于：
                </td>
                <td style="width: 200px;">
                    <input id="DateNoticeStart" class="easyui-datebox" style="width: 180px" />
                </td>
                <td style="width: 50px; height: 30px; text-align: right">
                </td>
                <td style="width: 200px;">
                    <input id="DateNoticeEnd" class="easyui-datebox" style="width: 180px;" />
                </td>
            </tr>
        </table>-->
        <table id="Notice_data">
            <thead>
                <tr>
                    <th data-options="field:'name',width:260 ">
                        施工内容
                    </th>
                    <th data-options="field:'image',width:450,formatter: pic ">
                        施工图片
                    </th>
                </tr>
            </thead>
        </table>
    </div>
    <div id="divNotcieAct">
        <a id="A1" onclick="addNotice()" class="easyui-linkbutton" data-options="iconCls:'icon-add'">
            新增</a> <a id="A3" onclick="EditNotice()" class="easyui-linkbutton" data-options="iconCls:'icon-edit'">
                编辑</a> <!--<a id="A4" onclick="ViewNotice()" class="easyui-linkbutton" data-options="iconCls:'icon-remove'">
                    查看</a>--><a id="A2" onclick="DelNotice()" class="easyui-linkbutton" data-options="iconCls:'icon-remove'">
                        删除</a>
    </div>
    <script type="text/javascript">
        $('#Notice_data').datagrid({
            iconCls: 'icon-edit', //图标 
            singleSelect: true,
            nowrap: false,
            striped: true,
            border: true,
            collapsible: false, //是否可折叠的               
            url: '../../databyjd/ConSitePictByjd.ashx',
            remoteSort: false,
            toolbar: divNotcieAct,
            fitColumns: true,
            singleSelect: true, //是否单选 
//            pagination: true,
//            rownumbers: true, //行号            
            frozenColumns: [[
               { field: 'ck', checkbox: true }
              ]],
            queryParams: {
                oper: "List"
            }
        });

        function pic(value, row, index) {
            value = 'data:image/png;base64,' + arrayBufferToBase64(value);
            row.by1 = value;
            return "<img src='" + value + "' style='width:200px;height:200px' />";
        }

        function DelNotice() {
            var row = $('#Notice_data').datagrid("getSelected");
            if (row) {
                //if (row.UserId == row.SubmitUserId || row.UserLevel < row.SubmitUserLevelId) {//删除：自己或领导有权限
                    if (confirm("确定执行此操作吗？此操作不可逆")) {
                        var obj = new Object();
                        obj["oper"] = "del";
                        obj["name"] = row.Id;
                        $.post("../../databyjd/ConSitePictByjd.ashx", obj, function (rsp) {
                            if (rsp) {
                                alert("删除成功");
                                $('#Notice_data').datagrid('reload');
                            } else {
                                alert("删除失败");
                            }
                        }, "JSON").error(function () {
                            $.messager.alert("提交错误");
                        });
                   // }
                }
//                else {
//                    alert("您没有权限删除该记录");
//                }
            } else {
                alert("请选择要操作的行");
            }
        }

        function addNotice() {
            //parent.UrlRedict('../DispatchManageSystem/MessageManage/Notice/NoticeAdd.aspx');
            //window.location.href = "ConSitePictByjd.htm";
            window.open("ConSitePictByjd.htm");
        }

        function EditNotice() {
            var row = $('#Notice_data').datagrid("getSelected");
            if (row) {
//                if (row.UserId == row.SubmitUserId) {//编辑：自己有权限
//                    parent.UrlRedict('../DispatchManageSystem/MessageManage/Notice/NoticeEdit.aspx?ProjectID=' + row.ID + '');
//                }
//                else {
//                    alert("您没有权限编辑该记录");
                //                }
                //                window.open('ConSitePictByjdEdit.htm?Id=' + row.Id + '&name=' + row.name + '&by1=' + row.by1 + '');
                window.open('ConSitePictByjdEdit.htm?Id=' + row.Id + '');
            } else {
                alert("请选择要操作的行");
            }
        }

        function ViewNotice() {
            var row = $('#Notice_data').datagrid("getSelected");
            if (row) {
                parent.UrlRedict('../DispatchManageSystem/MessageManage/Notice/NoticeView.aspx?ID=' + row.ID + '');
            } else {
                alert("请选择要操作的行");
            }
        }

        function MessageDoSearch() {
            var Title = document.getElementById("txtNoticeTitle").value;
            //var Author = document.getElementById("txtNoticeAuthor").value;
            var statrDate = $('#DateNoticeStart').datebox('getValue');
            var endDate = $('#DateNoticeEnd').datebox('getValue');

            $('#Notice_data').datagrid({
                url: '../../RequestData/MessageManage/MessageManageData.ashx',
                queryParams: {
                    Opreate: "GetList",
                    Type: 1,
                    Title: Title,
                    //Author: Author,
                    statrDate: statrDate,
                    endDate: endDate
                }
            })
        }

        function arrayBufferToBase64(buffer) {
            var binary = '';
            var bytes = new Uint8Array(buffer);
            var len = bytes.byteLength;
            for (var i = 0; i < len; i++) {
                binary += String.fromCharCode(bytes[i]);
            }
            return window.btoa(binary);
        }
    </script>
</body>
</html>
